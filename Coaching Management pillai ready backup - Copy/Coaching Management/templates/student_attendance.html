{% extends 'base.html' %}

{% block content %}

<!-- PAGE HEADER -->
<div class="p-4 mb-4 rounded-4 text-white d-flex align-items-center"
     style="background: linear-gradient(135deg, #4e73df, #1cc88a);">

    <!-- MINDSEED LOGO -->
    <svg width="44" height="44" viewBox="0 0 50 50" class="me-3">
        <rect x="0" y="5" rx="12" ry="12" width="50" height="40" fill="#ffffff"/>
        <path d="M25 15 
                 C18 15, 15 20, 15 25 
                 C15 32, 22 35, 25 40 
                 C28 35, 35 32, 35 25 
                 C35 20, 32 15, 25 15Z"
              fill="#1cc88a"/>
    </svg>

    <div>
        <h3 class="fw-bold mb-1">My Attendance</h3>
        <p class="mb-0 opacity-75">
            Track your attendance record and overall performance.
        </p>
    </div>
</div>

<!-- SUMMARY CARDS -->
<div class="row g-4 mb-4">

    <div class="col-md-4">
        <div class="card border-0 shadow h-100">
            <div class="card-body text-center">
                <h6 class="text-muted">Attendance Percentage</h6>
                <h2 class="fw-bold text-primary">{{ percentage }}%</h2>
            </div>
        </div>
    </div>

    <div class="col-md-4">
        <div class="card border-0 shadow h-100">
            <div class="card-body text-center">
                <h6 class="text-muted">Present Days</h6>
                <h2 class="fw-bold text-success">{{ present }}</h2>
            </div>
        </div>
    </div>

    <div class="col-md-4">
        <div class="card border-0 shadow h-100">
            <div class="card-body text-center">
                <h6 class="text-muted">Absent Days</h6>
                <h2 class="fw-bold text-danger">{{ total - present }}</h2>
            </div>
        </div>
    </div>

</div>

<!-- DETAILS + CHART -->
<div class="row g-4">

    <!-- TABLE -->
    <div class="col-md-7">
        <div class="card border-0 shadow rounded-4">
            <div class="card-body p-3">
                <h5 class="mb-3 fw-semibold">Attendance Records</h5>

                <div class="table-responsive">
                    <table class="table align-middle mb-0 attendance-table">
                        <thead>
                            <tr>
                                <th>Date</th>
                                <th>Status</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for row in records %}
                            <tr>
                                <td>{{ row.date }}</td>
                                <td>
                                    {% if row.status == 'Present' %}
                                        <span class="badge bg-success">Present</span>
                                    {% else %}
                                        <span class="badge bg-danger">Absent</span>
                                    {% endif %}
                                </td>
                            </tr>
                            {% else %}
                            <tr>
                                <td colspan="2" class="text-center text-muted py-3">
                                    No attendance records found.
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>

            </div>
        </div>
    </div>

    <!-- CHART -->
    <div class="col-md-5">
        <div class="card border-0 shadow rounded-4 h-100">
            <div class="card-body text-center">
                <h5 class="fw-semibold mb-3">Attendance Overview</h5>

                <!-- IMPORTANT: CANVAS WRAPPER -->
                <div style="height:260px;">
                    <canvas id="studentChart"
                            data-present="{{ present }}"
                            data-absent="{{ total - present }}">
                    </canvas>
                </div>

            </div>
        </div>
    </div>

</div>

<!-- ACTION -->
<div class="mt-4">
    <a href="/student" class="btn btn-outline-secondary">
        <i class="fa-solid fa-arrow-left me-1"></i>
        Back to Dashboard
    </a>
</div>

<!-- CHART SCRIPT (FIXED) -->
<script>
document.addEventListener("DOMContentLoaded", function () {

    const studentCanvas = document.getElementById('studentChart');
    if (!studentCanvas || typeof Chart === "undefined") {
        console.error("Chart.js not loaded");
        return;
    }

    const presentCount = Number(studentCanvas.dataset.present);
    const absentCount = Number(studentCanvas.dataset.absent);

    new Chart(studentCanvas, {
        type: 'doughnut',
        data: {
            labels: ['Present', 'Absent'],
            datasets: [{
                data: [presentCount, absentCount],
                backgroundColor: ['#1cc88a', '#e74a3b'],
                borderWidth: 1
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: {
                    position: 'bottom'
                }
            }
        }
    });
});
</script>

<!-- LOCAL STYLES -->
<style>
    .attendance-table thead th {
        background-color: #f8f9fc;
        font-weight: 600;
    }

    .attendance-table tbody tr:hover {
        background-color: #f1f5ff;
    }
</style>

{% endblock %}
